--- 
title: "LASV Bioplex Protein Data"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    source_code: embed
    theme: flatly 
    vertical_layout: fill
    storyboard: true
    

--- 

```{r setup, include=FALSE, warning=FALSE, }

###-----Load Packages----

if (!require("pacman")) install.packages("pacman")
pacman::p_load(yaml,
               knitr,
               markdown,
               shiny,
               shinyWidgets,
               devtools,
               ggplot2,
               stats,
               statmod,
               tidyverse,
               pROC,
               sqldf,
               corrplot,
               readxl,
               hablar,
               ggpubr,
               patchwork,
               tidyr,
               dplyr,
               plotly, 
               DT,
               tiff, 
               ggsci, 
               DT, 
               stargazer, 
               svglite, 
               Cairo, 
               magrittr,
               gghighlight,
               flexdashboard,
               ggrepel,
               lubridate,
               RColorBrewer, 
               rJava, 
               dygraphs)
# load("~/lasvchal/Jamie/lasvClinical/lasvShiny/lasvClinical_20200623.Rdata")
# library(yaml)
# library(knitr)
# library(rmarkdown)

# load("lasvClinical_20200623.Rdata")
options(scipen = 999)
set.seed(1234)
# pth <- dirname(rstudioapi::getSourceEditorContext()$path)
# 
# source("~/lasvchal/Jamie/lasvClinical/reviewers2020/dataPreProcessing.R")
# pth <- "~/lasvchal/Jamie/lasvClinical/reviewers2020"




```


Compare
=======================================================================

## Compare Two Factors {data-height=600}

```{r}


  ui = fillPage(

    
    sidebarPanel(
      # width = 3, 
        pickerInput("Factor1", "Factor 1 (x-axis)",
                     choices  = colnames(adm_all %>% select(ct:CRE)),
                     selected = "ct",
                     options  = list(`actions-box` = TRUE), multiple = F
                     ),
         
         pickerInput("Factor2", "Factor 2 (y-axis)",
                     choices  = colnames(adm_all %>% select(ct:CRE)),
                     selected = "PAI1",
                     options  = list(`actions-box` = TRUE), multiple = F
                     )
      ),
    

    mainPanel(
      tabsetPanel(
        tabPanel( ("Scatter"),
                  plotlyOutput("scatterPlot")
                  ),

        tabPanel( ("Box Plots"),
                  plotlyOutput("single.box.plot")
                  ), 
        tabPanel( ("Stats"),
                  plotOutput("single.box.stats")
                  )
        
        )

      )
   )

  
  
  server <- function(input, output, session) {

  
    output$scatterPlot <- renderPlotly({
    
      adm_all %>%
        ggplot(aes_string(x=input$Factor1, y = input$Factor2)) +
        scale_x_log10() + scale_y_log10() +
        geom_point(aes(color=Outcome))
    })
  
    box.select <- reactive ({
      box.data  %>%
        dplyr::filter(Factor %in% c(input$Factor1, input$Factor2)) %>%
        as.data.frame() %>% 
        ggboxplot(x="Outcome", 
                    y = "Value",
                    color="Outcome",
                    palette = c("red", "blue", "green4", "purple")) +
          scale_x_discrete(labels=c("F", "S", "OFI", "HC")) +
          scale_y_log10() +
          facet_wrap("Name_Units", scales = "free", ncol=2) +
          # ylab(get.pretty.factor(c(input$Factor1, input$Factor2))) +
          theme(text = element_text(size=24),
                plot.title = element_text(hjust = .5),
                panel.grid.major = element_blank(),
                panel.grid.minor = element_blank(),
                panel.spacing = unit(1.25, "lines"),
                axis.title.x = element_blank(),
                axis.text = element_text(size = 20),
                axis.title.y = element_blank(),
                legend.position = "none", 
                strip.background = element_blank(),
                strip.placement = "outside")
    })
  

    output$single.box.plot <- renderPlotly({
        box.select()
    })
    
    output$single.box.stats <- renderPlot({
        box.select() + stat_compare_means(comparisons = my_comparisons,
                             # size=4,
                             label = "p.signif",
                             method = "wilcox.test")
    })


  }

  shinyApp(ui, server)

```

Boxplots
=======================================================================
Column 
-----------------------------------------------------------------------
## By Protein Category 

```{r}


   # sidebarPanel(
   # 
   #       sliderInput("Age",
   #                   "Age",
   #                   min = 0, max = 100, value = c(0, 100), ticks = TRUE, animate = F),
   #       pickerInput(inputId  = "Outcome", label = "Outcome",
   #                   choices  = levels(factor(adm_all$Outcome)),
   #                   selected = levels(factor(adm_all$Outcome)),
   #                   options  = list(`actions-box` = TRUE), multiple = T,
   #                   ),
   # 
   #       pickerInput("dpi", "DPI",
   #                   choices  = levels(factor(adm_all$dpi)),
   #                   selected = levels(factor(adm_all$dpi)),
   #                   options  = list(`actions-box` = TRUE), multiple = T
   #                   ),
   # 
   #  ),

ui <- fluidPage(
  tags$h2("Update pickerInput"),

  fluidRow(
    column(
      width = 5, offset = 1,
      pickerInput(
        inputId = "p1",
        label = "classic update",
        choices = rownames(mtcars)
      )
    ),
    column(
      width = 5,
      pickerInput(
        inputId = "p2",
        label = "disabled update",
        choices = rownames(mtcars)
      )
    )
  ),

  fluidRow(
    column(
      width = 10, offset = 1,
      sliderInput(
        inputId = "up",
        label = "Select between models with mpg greater than :",
        width = "50%",
        min = min(mtcars$mpg),
        max = max(mtcars$mpg),
        value = min(mtcars$mpg),
        step = 0.1
      )
    )
  )

)

server <- function(input, output, session) {

  observeEvent(input$up, {
    mtcars2 <- mtcars[mtcars$mpg >= input$up, ]

    # Method 1
    updatePickerInput(session = session, inputId = "p1",
                      choices = rownames(mtcars2))

    # Method 2
    disabled_choices <- !rownames(mtcars) %in% rownames(mtcars2)
    updatePickerInput(
      session = session, inputId = "p2",
      choices = rownames(mtcars),
      choicesOpt = list(
        disabled = disabled_choices,
        style = ifelse(disabled_choices,
                       yes = "color: rgba(119, 119, 119, 0.5);",
                       no = "")
      )
    )
  }, ignoreInit = TRUE)

}

shinyApp(ui = ui, server = server)


```

ROC Curves
=======================================================================

Column {data-width=350}
-----------------------------------------------------------------------

## By Protein Category 

```{r}
if (interactive()) {

# Example of UI with fluidPage
ui <- fluidPage(

  # Application title
  titlePanel("Hello Shiny!"),

  sidebarLayout(

    # Sidebar with a slider input
    sidebarPanel(
      sliderInput("obs",
                  "Number of observations:",
                  min = 0,
                  max = 1000,
                  value = 500)
    ),

    # Show a plot of the generated distribution
    mainPanel(
      plotOutput("distPlot")
    )
  )
)

# Server logic
server <- function(input, output) {
  output$distPlot <- renderPlot({
    hist(rnorm(input$obs))
  })
}

# Complete app with UI and server components
shinyApp(ui, server)


}
```


